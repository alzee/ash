#!/bin/bash
#
# vim:ft=bash

############### Variables ###############

############### Functions ###############

############### Main Part ###############

install_composer(){
    if [ ! -x ~/.local/bin/composer ];then
        say Installing composer...
        local a=composer-setup.php
        curl -L https://getcomposer.org/installer -o $a
        # TODO not return
        if echo -n $(curl -s https://composer.github.io/installer.sig) $a | sha384sum -c --status;then
            php $a && rm $a
            mkdir ~/.local/bin -p
            mv composer.phar ~/.local/bin/composer
        else
            say checksum fail!
        fi
    fi
}

install_symfony(){
    curl -sS https://get.symfony.com/cli/installer | bash
    ln -sf ../../.symfony5/bin/symfony .local/bin/
}

install_deno(){
    curl -fsSL https://deno.land/install.sh | sh
    ln -sf ../../.deno/bin/deno ~/.local/bin/
}

install_rust(){
    curl --proto '=https' --tlsv1.3 https://sh.rustup.rs -sSf | sh
    echo Generating tab-completion scripts for your shell.
    mkdir -p ~/.local/share/bash-completion/completions/
    rustup completions bash >> ~/.local/share/bash-completion/completions/rustup
    rustup completions bash cargo >> ~/.local/share/bash-completion/completions/cargo
    rustup component add rust-analyzer
}

install_zed(){
    curl -f https://zed.dev/install.sh | sh
}

install_uv(){
    curl -LsSf https://astral.sh/uv/install.sh | sh
}

install_fastapi(){
    uv add fastapi --extra standard
}

install_nvm(){
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
    nvm install node
    nvm alias default node
}

install_fnm(){
    curl -fsSL https://fnm.vercel.app/install | bash
    . ~/.bashrc
    fnm i --latest
    #corepack enable yarn
    #corepack enable pnpm
}

install_ollama(){
    curl -fsSL https://ollama.com/install.sh | sh
}

install_huggingface(){
    curl -LsSf https://hf.co/cli/install.sh | bash
    # uv tool install huggingface_hub
}

install_claude(){
    curl -fsSL https://claude.ai/install.sh | bash
    #npm install -g @anthropic-ai/claude-code
}

install_cursor(){
    curl https://cursor.com/install -fsS | bash
    ln -sf cursor-agent ~/.local/bin/cursor
}

install_codex(){
    npm i -g @openai/codex
}

install_copilot(){
    curl -fsSL https://gh.io/copilot-install | bash
    # npm install -g @github/copilot
}

install_gemini(){
    npm install -g @google/gemini-cli
}

install_taro(){
    npm install -g @tarojs/cli
}

_install(){
    install_$1
}

_uninstall(){
    :
}

#tools=$(declare -F | awk '/install_/{sub(/.*install_/, ""); print $1}' | xargs)
tools=$(grep -oP '^install_\K\w+' "$0" | xargs)

_help(){
    echo 'Usage: tool i <tool_name>'
    echo tools supported:
    echo $tools
}

case $1 in
    i)
        _install "$2"
        ;;
    u)
        _uninstall "$2"
        ;;
    *)
        _help
        ;;
esac
