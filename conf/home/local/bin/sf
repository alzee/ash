#!/bin/bash
#
# vim:ft=sh

############### Variables ###############
boilerplates_dir=~/w/boilerplates/

############### Functions ###############

new(){
    local pkgs i opt
    pkgs="admin
    vich/uploader-bundle
    symfony/ux-chartjs
    overtrue/pinyin
    phpoffice/phpspreadsheet
    --dev orm-fixtures"
    # friendsofsymfony/ckeditor-bundle
    symfony new --webapp "$1"

    if [ $? -gt 0 ]; then
        exit
    fi

    cd "$1"

    for i in $pkgs
    do
        if [ "$i" = --dev ]; then
            opt="$i"
            continue
        fi
        echo -e \\n***Installing: "$opt" "$i"
        composer req $opt "$i"
        git add -A; git commit -m "$i"
        unset opt
    done

    echo Create Admin Dashboard
    bin/console make:admin:dashboard
    ln -s src/Controller/Admin/ admin
    git add -A; git commit -m "admin dashboard"

    echo Init mdbook
    mdbook init docs
    ln -s ../docs/book/ public/docs
    git add -A; git commit -m "docs"

    # l=$(find $boilerplates_dir/symfony/)
}

############### Main Part ###############

case "$1" in
    s)
        symfony serve -d --allow-all-ip --allow-http
        sudo systemctl restart redis
        ;;
    S)
        symfony serve:stop
        ;;
    n|new)
        new "$2"
        ;;
    *)
        symfony "$@"
        ;;
esac
