<VirtualHost *:80>
    ServerName ai.itove.com
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName ai.itove.com

    LogLevel info
    ErrorLog /var/log/ai.itove.com_error.log
    TransferLog /var/log/ai.itove.com_access.log

    SSLEngine On
    SSLCertificateFile /home/al/cert/itove.com.fullchain.cer
    SSLCertificateKeyFile /home/al/cert/itove.com.key

    ProxyPreserveHost On
    AllowEncodedSlashes NoDecode

    # see https://github.com/open-webui/open-webui/discussions/1235#discussioncomment-9666471
    <Location "/">
        Require all granted
        ProxyPass http://127.0.0.1:3000/ nocanon upgrade=websocket timeout=3600
        ProxyPassReverse http://127.0.0.1:3000/
        ProxyPassReverseCookieDomain 127.0.0.1 ai.itove.com

        RequestHeader set "X-Real-IP" expr=%{REMOTE_ADDR}
        RequestHeader set "X-Forwarded-For" expr=%{REMOTE_ADDR}
        RequestHeader set "X-Forwarded-Port" expr=%{SERVER_PORT}
        RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
        RequestHeader set "X-Forwarded-Ssl" expr=%{HTTPS}
    </Location>

</VirtualHost>
